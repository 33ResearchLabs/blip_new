<!DOCTYPE html>
<html>
<head>
    <title>Clear Cache & Service Workers</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        button {
            background: #0070f3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover { background: #0051cc; }
        .success { color: #0070f3; margin-top: 20px; }
        .error { color: #e00; }
        .info { background: #e7f3ff; padding: 15px; border-radius: 6px; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”§ Fix HMR WebSocket Issues</h1>

        <div class="info">
            <strong>This will fix the "WebSocket failed" and HMR errors.</strong>
            <p>Click the buttons below in order:</p>
        </div>

        <button onclick="clearServiceWorkers()">1. Clear Service Workers</button>
        <button onclick="clearCache()">2. Clear All Caches</button>
        <button onclick="clearStorage()">3. Clear Storage</button>
        <button onclick="reloadHard()">4. Hard Reload</button>

        <div id="status"></div>

        <div class="info" style="margin-top: 30px;">
            <strong>Or do it manually:</strong>
            <ol>
                <li>Press <kbd>F12</kbd> to open DevTools</li>
                <li>Go to <strong>Application</strong> tab</li>
                <li>Click <strong>Service Workers</strong></li>
                <li>Click <strong>Unregister</strong> for all workers</li>
                <li>Click <strong>Clear site data</strong> at the top</li>
                <li>Press <kbd>Cmd+Shift+R</kbd> (Mac) or <kbd>Ctrl+Shift+R</kbd> (Windows)</li>
            </ol>
        </div>
    </div>

    <script>
        const status = document.getElementById('status');

        function log(msg, isError = false) {
            const div = document.createElement('div');
            div.className = isError ? 'error' : 'success';
            div.textContent = msg;
            status.appendChild(div);
        }

        async function clearServiceWorkers() {
            try {
                const registrations = await navigator.serviceWorker.getRegistrations();
                for (let registration of registrations) {
                    await registration.unregister();
                    log('âœ“ Unregistered service worker: ' + registration.scope);
                }
                if (registrations.length === 0) {
                    log('âœ“ No service workers found');
                }
            } catch (err) {
                log('âœ— Error clearing service workers: ' + err.message, true);
            }
        }

        async function clearCache() {
            try {
                const cacheNames = await caches.keys();
                for (let name of cacheNames) {
                    await caches.delete(name);
                    log('âœ“ Deleted cache: ' + name);
                }
                if (cacheNames.length === 0) {
                    log('âœ“ No caches found');
                }
            } catch (err) {
                log('âœ— Error clearing cache: ' + err.message, true);
            }
        }

        function clearStorage() {
            try {
                localStorage.clear();
                sessionStorage.clear();
                log('âœ“ Cleared localStorage and sessionStorage');
            } catch (err) {
                log('âœ— Error clearing storage: ' + err.message, true);
            }
        }

        function reloadHard() {
            log('âŸ³ Performing hard reload in 2 seconds...');
            setTimeout(() => {
                window.location.href = window.location.origin + '?t=' + Date.now();
                window.location.reload(true);
            }, 2000);
        }

        // Auto-clear on load
        window.addEventListener('load', () => {
            setTimeout(async () => {
                log('ðŸš€ Auto-clearing...');
                await clearServiceWorkers();
                await clearCache();
                clearStorage();
                log('âœ… Done! Click "Hard Reload" button or press Cmd+Shift+R');
            }, 500);
        });
    </script>
</body>
</html>
